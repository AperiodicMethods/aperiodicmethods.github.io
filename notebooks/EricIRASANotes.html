
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IRASA &#8212; Aperiodic  Methods</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Aperiodic  Methods</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00-Overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01-LiteratureSearch.html">
   Literature Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-Simulations.html">
   Simulations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Methods
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10-SpectralFitting.html">
   Spectral Fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-IRASA.html">
   IRASA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-AutoCorrelation.html">
   AutoCorrelation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-Fluctuations.html">
   Fluctuation Analyses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14-Complexity.html">
   Complexity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-Information.html">
   Information Metrics
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/EricIRASANotes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/aperiodicmethods//master?urlpath=tree/apmethods/notebooks/EricIRASANotes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes">
   Notes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#macros-and-helper-functions">
   Macros and Helper Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#experiment-1-no-oscillations">
   Experiment 1: No Oscillations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aperiodic-1-sinusoid">
   Aperiodic + 1 Sinusoid
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aperiodic-4-well-spaced-sinusoids-not-sure-about-this-experiment-anymore">
   Aperiodic + 4 Well-Spaced Sinusoids (Not sure about this experiment anymore)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aperiodic-cluster-of-sinusoids-seems-redundant-with-central-frequency">
   Aperiodic + Cluster of Sinusoids (seems redundant with central frequency)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aperiodic-with-central-frequency">
   Aperiodic with Central Frequency
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#closer-look-low-frequency-central-frequencies">
   Closer Look: Low Frequency Central Frequencies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#closer-look-high-frequency-central-frequency">
   Closer Look: High Frequency Central Frequency
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aperiodic-noise-with-knee">
   Aperiodic Noise with Knee
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-errors">
     Visualizing the Errors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#closer-look">
   Closer Look
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">neurodsp.sim</span> <span class="kn">import</span> <span class="n">sim_combined</span>
<span class="kn">from</span> <span class="nn">neurodsp.spectral</span> <span class="kn">import</span> <span class="n">compute_spectrum</span><span class="p">,</span> <span class="n">trim_spectrum</span>
<span class="kn">from</span> <span class="nn">neurodsp.utils.data</span> <span class="kn">import</span> <span class="n">create_times</span>
<span class="kn">from</span> <span class="nn">neurodsp.plts</span> <span class="kn">import</span> <span class="n">plot_time_series</span><span class="p">,</span> <span class="n">plot_power_spectra</span>
<span class="kn">from</span> <span class="nn">neurodsp.utils.norm</span> <span class="kn">import</span> <span class="n">normalize_sig</span>
<span class="c1"># Import IRASA</span>
<span class="kn">from</span> <span class="nn">neurodsp.aperiodic</span> <span class="kn">import</span> <span class="n">compute_irasa</span><span class="p">,</span> <span class="n">fit_irasa</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Slider</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">fractions</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="irasa">
<h1>IRASA<a class="headerlink" href="#irasa" title="Permalink to this headline">¶</a></h1>
<p>IRASA stands for irregularly resampled auto-spectral analysis. It assumes the signal model is an aperiodic component, namely a 1/f component, added with finitely many sinusoids. These sinusoids manifest themselves as discrete spikes in the power spectrum. IRASA computes the aperiodic component by appealing to the self-similar nature of signals whose power spectrum obeys a power law. Unlike FOOOF, IRASA requires access to the time series data itself. By resampling the time series at non-integer rates, the spikes in the power spectrum corresponding to the sinusoids will be shifted in frequency by a quantity proportional to the resampling rate. However, self-similarity of the aperiodic component ensures that the power law decay remains the same across resamplings. Sinusoids are then averaged out across the power spectra of the resampled time series.</p>
<p>IRASA does not explicitly consider signals with a knee, nor does it consider signals where there are central frequencies with some variance around them as in the setting of FOOOF. The purpose of this notebook is to test the robustness of IRASA to these deviations and to quantify the error in estimating <span class="math notranslate nohighlight">\(\chi\)</span> as we test IRASA on various signals whose power spectrum deviates from a strict <span class="math notranslate nohighlight">\(1/f\)</span> structure.</p>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>IRASA seems to perform well when there are a few sinusoids added to the aperiodic component where the frequencies of those sinusoids are sufficiently different, e.g. well-spaced in the frequency range.</p>
<ul>
<li><p>When the frequencies are close to one another, IRASA does not perform as well.</p></li>
</ul>
</li>
<li><p>Lower frequency sinusoids also seem to negatively impact IRASA’s estimation.</p></li>
<li><p>IRASA’s behavior seems to be stable across different values of <span class="math notranslate nohighlight">\(\chi \in (-3, 0)\)</span>.</p></li>
<li><p>In the context of a signal with a central frequency and aperiodic noise, IRASA is not robust to the central frequency’s relative height or the bandwidth.</p></li>
<li><p>Interestingly, for knee signals without an aperiodic component, IRASA’s estimate for the aperiodic PSD does feature a knee but it’s often the wrong shape. The error in estimating both exponents of the knee is on average between 0.5 and 0.8.</p>
<ul>
<li><p>For the Lorenztian given by
$<span class="math notranslate nohighlight">\( \frac{1}{\omega^{\chi_1}(\omega^{\chi_2} + k)},\)</span><span class="math notranslate nohighlight">\(
IRASA performs the worst when \)</span>\chi_1 &gt; \chi_2<span class="math notranslate nohighlight">\( and \)</span>\chi_2$ is near zero. In this context, the PSD is visually similar to a powerlaw and does not feature a knee.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="macros-and-helper-functions">
<h2>Macros and Helper Functions<a class="headerlink" href="#macros-and-helper-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1">#   Macros</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="c1"># Parameter ranges</span>
<span class="n">FS_RANGE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">1060</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">F_RANGE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">FREQS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">F_RANGE</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">25</span><span class="p">))</span>
<span class="n">CHIS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>   <span class="c1"># Use negative values per NeuroDSP convention.</span>


<span class="c1"># Static constants</span>
<span class="n">N_SECONDS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">FS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span>
<span class="n">TIMES</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>
<span class="n">NUM_TRIALS</span> <span class="o">=</span> <span class="mi">10</span>


<span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1">#   Fitting Helper Functions</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="k">def</span> <span class="nf">log_space_freqs</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given an array of frequency values, returns a subset of those frequency values which are approximately</span>
<span class="sd">    equispaced logarithmically.&quot;&quot;&quot;</span>
    
    <span class="c1"># Grab the lowest and highest frequencies to form a logarithmic grid of frequencies, not necessarily</span>
    <span class="c1"># corresponding to frequencies in the array freqs</span>
    <span class="n">f_start</span><span class="p">,</span> <span class="n">f_end</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">log_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">f_start</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">f_end</span><span class="p">),</span> <span class="n">n_points</span><span class="p">)</span>
    
    <span class="c1"># For every element in log_grid, find the closest element in freqs</span>
    <span class="n">log_freq_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">log_freq</span> <span class="o">-</span> <span class="n">freqs</span><span class="p">))</span> <span class="k">for</span> <span class="n">log_freq</span> <span class="ow">in</span> <span class="n">log_grid</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">log_freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">log_freq_indices</span><span class="p">]</span>
    
    <span class="c1"># Throw out any duplicates</span>
    <span class="n">log_freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">log_freqs</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">log_freqs</span>

<span class="k">def</span> <span class="nf">fit_func</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A fit function to use for fitting IRASA separated 1/f power spectra components.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">freqs</span> <span class="o">+</span> <span class="n">intercept</span>

<span class="k">def</span> <span class="nf">knee_func</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logarithm base 10 of the function</span>
<span class="sd">    </span>
<span class="sd">    offset * 1/(freqs**chi1 * (freqs**chi2 + knee))</span>
<span class="sd">    </span>
<span class="sd">    used to fit a knee model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">chi1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">freqs</span><span class="o">**</span><span class="n">chi2</span> <span class="o">+</span> <span class="n">knee</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit_irasa_logspace</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd_aperiodic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fit the IRASA derived aperiodic component of the spectrum. The fitting uses logarithmically</span>
<span class="sd">    spaced frequencies. This is basically copied from NeuroDSP&#39;s implementation with only a minor modification before</span>
<span class="sd">    the spectral fitting.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqs : 1d array</span>
<span class="sd">        Frequency vector, in linear space.</span>
<span class="sd">    psd_aperidic : 1d array</span>
<span class="sd">        Power values, in linear space.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    intercept : float</span>
<span class="sd">        Fit intercept value.</span>
<span class="sd">    slope : float</span>
<span class="sd">        Fit slope value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This fits a linear function of the form `y = ax + b` to the log-log aperiodic power spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Grab log spaced frequencies. Subsample by a factor of 2.</span>
    <span class="n">resampled_freqs</span> <span class="o">=</span> <span class="n">log_space_freqs</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">freqs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Grab the corresponding indices to resample the psd.</span>
    <span class="n">resampled_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resampled_freq</span> <span class="o">-</span> <span class="n">freqs</span><span class="p">))</span> <span class="k">for</span> <span class="n">resampled_freq</span> <span class="ow">in</span> <span class="n">resampled_freqs</span><span class="p">])</span>
    <span class="n">resampled_psd</span> <span class="o">=</span> <span class="n">psd_aperiodic</span><span class="p">[</span><span class="n">resampled_idxs</span><span class="p">]</span>
    
    <span class="n">popt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_func</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resampled_freqs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resampled_psd</span><span class="p">))</span>
    <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span>

    <span class="k">return</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span>

<span class="k">def</span> <span class="nf">fit_irasa_knee</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd_aperiodic</span><span class="p">):</span>
    
    <span class="c1"># Force non-negative parameters.</span>
    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
    
    <span class="c1"># Dont feed in logarithmic frequencies.</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">knee_func</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">psd_aperiodic</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">))</span>
    <span class="n">offset</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span> <span class="o">=</span> <span class="n">popt</span>
    
    <span class="k">return</span> <span class="n">offset</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span>

<span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1">#   Simulation Functions</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="k">def</span> <span class="nf">sim_central_freq</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">ht</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a time series whose full power spectrum consists of a power law with exponent chi</span>
<span class="sd">    and a gaussian peak at central_freq with standard deviation bw and relative height ht.</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    n_seconds: float</span>
<span class="sd">        Number of seconds elapsed in the time series.</span>
<span class="sd">    fs: float</span>
<span class="sd">        Sampling rate.</span>
<span class="sd">    chi: float</span>
<span class="sd">        Power law exponent.</span>
<span class="sd">    central_freq: float</span>
<span class="sd">        Central frequency for the gaussian peak in Hz.</span>
<span class="sd">    bw: float</span>
<span class="sd">        Bandwidth, or standard deviation, of gaussian peak in Hz.</span>
<span class="sd">    ht: float</span>
<span class="sd">        Relative height in log_10(Hz) over the aperiodic component of the gaussian peak at central_freq.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig: 1d array</span>
<span class="sd">        Time series with desired power spectrum.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Simulate aperiodic noise with exponent -2 superimposed over an oscillatory component with</span>
<span class="sd">    central frequency 20.</span>

<span class="sd">    &gt;&gt;&gt; sig = sim_gauss_peak(n_seconds=50, fs=500, chi=-2, central_freq=20, bw=5, ht=7)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

    <span class="c1"># Construct the aperiodic component and compute its Fourier transform. Only use the</span>
    <span class="c1"># first half of the frequencies from the Fourier transform since the signal is real.</span>
    <span class="n">sig_components</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span><span class="p">:</span> <span class="n">chi</span><span class="p">}}</span>
    <span class="n">sig_ap</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">sig_components</span><span class="p">)</span>
    <span class="n">sig_len</span> <span class="o">=</span> <span class="n">sig_ap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">sig_ap_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">sig_ap</span><span class="p">)[</span><span class="mi">0</span><span class="p">:(</span><span class="n">sig_len</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Create the range of frequencies that appear in the power spectrum since these</span>
    <span class="c1"># will be the frequencies in the cosines we sum below</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">sig_len</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Construct the array of relative heights above the aperiodic power spectrum</span>
    <span class="n">rel_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ht</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">central_freq</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bw</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">])</span>

    <span class="c1"># Build an array of the sum of squares of the cosines as they appear in the calculation of the</span>
    <span class="c1"># amplitudes</span>
    <span class="n">cosine_norms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                          <span class="n">norm</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">times</span><span class="p">),</span> <span class="mi">2</span>
                          <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freqs</span>
                        <span class="p">])</span>

    <span class="c1"># Build an array of the amplitude coefficients</span>
    <span class="n">cosine_coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                    <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sig_ap_hat</span><span class="p">[</span><span class="n">ell</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sig_ap_hat</span><span class="p">[</span><span class="n">ell</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">rel_heights</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sig_ap_hat</span><span class="p">[</span><span class="n">ell</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">cosine_norms</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cosine_norms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="p">)</span>

    <span class="c1"># Add cosines with the respective coefficients and with a random phase shift for each one</span>
    <span class="n">sig_periodic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cosine_coeffs</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span><span class="o">*</span><span class="n">times</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="k">for</span> <span class="n">ell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cosine_norms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">)</span>

    <span class="n">sig</span> <span class="o">=</span> <span class="n">sig_ap</span> <span class="o">+</span> <span class="n">sig_periodic</span>

    <span class="k">return</span> <span class="n">normalize_sig</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sim_knee</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a time series whose power spectrum follows the Lorentzian equation</span>

<span class="sd">    P(f) = 1 / (f**chi1 * (f**chi2 + k))</span>

<span class="sd">    using a sum of sinusoids.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    n_seconds: float</span>
<span class="sd">        Number of seconds elapsed in the time series.</span>
<span class="sd">    fs: float</span>
<span class="sd">        Sampling rate.</span>
<span class="sd">    chi1: float</span>
<span class="sd">        Power law exponent before the knee.</span>
<span class="sd">    chi2: float</span>
<span class="sd">        Power law exponent added to chi1 after the knee.</span>
<span class="sd">    k: float</span>
<span class="sd">        Knee parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig: 1d array</span>
<span class="sd">        Time series with desired power spectrum.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The slope of the log power spectrum before the knee is -chi1 whereas after the knee it is -(chi1 + chi2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Simulate a time series with (chi1, chi2, k) = (1, 2, 100)</span>

<span class="sd">    &gt;&gt; sim_knee(n_seconds=10, fs=10**3, chi1=1, chi2=2, k=100)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">sig_len</span> <span class="o">=</span> <span class="n">fs</span><span class="o">*</span><span class="n">n_seconds</span>

    <span class="c1"># Create the range of frequencies that appear in the power spectrum since these</span>
    <span class="c1"># will be the frequencies in the cosines we sum below</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">sig_len</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Drop the DC component</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># Map the frequencies under the (square root) Lorentzian. This will give us the amplitude coefficients</span>
    <span class="c1"># for the sinusoids.</span>
    <span class="n">cosine_coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">f</span><span class="o">**</span><span class="n">chi1</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="o">**</span><span class="n">chi2</span> <span class="o">+</span> <span class="n">k</span><span class="p">)))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">])</span>

    <span class="c1"># Add sinusoids with a random phase shift</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">cosine_coeffs</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">times</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="k">for</span> <span class="n">ell</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqs</span><span class="p">)]</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">normalize_sig</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

<span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1">#  Experiment functions</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="k">def</span> <span class="nf">multiple_sines_trial</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">sine_freqs</span><span class="p">,</span> <span class="n">f_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_space_irasa</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a time series with power law exponent chi and sinusoids with frequencies sine_freqs</span>
<span class="sd">    and returns the estimated power law exponent using IRASA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    
    <span class="c1"># Collect IRASA settings</span>
    <span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">f_range</span><span class="p">}</span>
    <span class="n">sim_components</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span> <span class="p">:</span> <span class="n">chi</span><span class="p">},</span>
                  <span class="s1">&#39;sim_oscillation&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;freq&#39;</span> <span class="p">:</span> <span class="n">sine_freq</span><span class="p">}</span> <span class="k">for</span> <span class="n">sine_freq</span> <span class="ow">in</span> <span class="n">sine_freqs</span><span class="p">]}</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">sim_components</span><span class="p">)</span>
    

    <span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
    <span class="n">fit_off</span><span class="p">,</span> <span class="n">fit_exp</span> <span class="o">=</span> <span class="n">fit_irasa</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">log_space_irasa</span> <span class="k">else</span> <span class="n">fit_irasa_logspace</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fit_exp</span>

<span class="k">def</span> <span class="nf">central_frequency_trial</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f_range</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a time series with power law exponent chi and sinusoids with frequencies sine_freqs</span>
<span class="sd">    and returns the estimated power law exponent using IRASA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    
    <span class="c1"># Collect IRASA settings</span>
    <span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">f_range</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">sim_central_freq</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">ht</span><span class="p">)</span>
    
    <span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
    <span class="n">fit_off</span><span class="p">,</span> <span class="n">fit_exp</span> <span class="o">=</span> <span class="n">fit_irasa</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fit_exp</span>

<span class="k">def</span> <span class="nf">knee_trial</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">sim_knee_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a time series with power law exponent chi and sinusoids with frequencies sine_freqs</span>
<span class="sd">    and returns the estimated power law exponent using IRASA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    
    <span class="c1"># Collect IRASA settings</span>
    <span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">f_range</span><span class="p">}</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">sim_knee</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="o">**</span><span class="n">sim_knee_kwargs</span><span class="p">)</span>
    

    <span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
    <span class="n">fit_offset</span><span class="p">,</span> <span class="n">fit_chi1</span><span class="p">,</span> <span class="n">fit_chi2</span><span class="p">,</span> <span class="n">fit_knee</span> <span class="o">=</span> <span class="n">fit_irasa_knee</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fit_chi1</span><span class="p">,</span> <span class="n">fit_chi2</span><span class="p">,</span> <span class="n">fit_knee</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="experiment-1-no-oscillations">
<h2>Experiment 1: No Oscillations<a class="headerlink" href="#experiment-1-no-oscillations" title="Permalink to this headline">¶</a></h2>
<p>To start, we compare how well IRASA does at estimating the power law exponent when there are no oscillations. We compare this to the modified IRASA where we downsample the power spectrum at logarithmically spaced frequencies and look at how the error behaves as a function of the sampling rate. We choose the minimal sampling rate to be at least 3 TIMES that of the maximal frequency in the frequency range, since IRASA seems to perform very poorly when the maximum of the frequency range is close to the Nyquist frequency. Further, we look at the average error and the variance of the error across many trials since the results of each trial are a function of the draw of spectrally rotated noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the dataframes</span>
<span class="n">parameter_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FS_RANGE</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)))</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_grid</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_log</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">fs</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">trial_idx</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">FS_RANGE</span><span class="p">,</span> <span class="n">CHIS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)):</span>
    <span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">F_RANGE</span><span class="p">}</span>
    <span class="n">sim_components</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sim_powerlaw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;exponent&#39;</span> <span class="p">:</span> <span class="n">chi</span><span class="p">}}</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">sim_combined</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">sim_components</span><span class="p">)</span>

    <span class="c1"># Compute aperiodic component using IRASA</span>
    <span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>

    <span class="c1"># Fit using all frequency data and using subsampled log-spaced frequencies</span>
    <span class="n">fit_off</span><span class="p">,</span> <span class="n">fit_exp</span> <span class="o">=</span> <span class="n">fit_irasa</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span>
    <span class="n">fit_off_log</span><span class="p">,</span> <span class="n">fit_exp_log</span> <span class="o">=</span> <span class="n">fit_irasa_logspace</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">)</span>
    
    <span class="n">loc_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">fs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trial_idx</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_exp</span> <span class="o">-</span> <span class="n">chi</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_exp_log</span> <span class="o">-</span> <span class="n">chi</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>36.73 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a dataframe of average errors and keep track of the variances as well</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;chi_err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="c1"># Get rid of the top level of column label to make pivoting easier</span>
<span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="c1"># Finally, flatten the index</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>

<span class="n">mean_var_df_log</span> <span class="o">=</span> <span class="n">df_log</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;chi_err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="n">mean_var_df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>

<span class="c1"># Pivot to get a matrix of mean errors and variances</span>
<span class="n">mean_errs_df</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vars_df</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">mean_errs_df_log</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vars_df_log</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">])[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1">##################################</span>
<span class="c1">#   </span>
<span class="c1">#  Vanilla IRASA Heat Maps</span>
<span class="c1">#</span>
<span class="c1">##################################</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Mean of $\chi$ Errors&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Grab the dynamic range of both mean errors</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mean_errs_df_log</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">mean_errs_df_log</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Plot mean errors for both IRASAs</span>
<span class="n">cax_mean</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f_s$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plot mean errors for vanilla IRASA</span>
<span class="n">cax_mean2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_errs_df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f_s$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_mean2</span><span class="p">)</span>

<span class="c1"># Set tick marks and tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FS_RANGE</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FS_RANGE</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FS_RANGE</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]);</span>

<span class="c1">##################################</span>
<span class="c1">#   </span>
<span class="c1">#  Log spaced IRASA Heat Maps</span>
<span class="c1">#</span>
<span class="c1">##################################</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Variance of $\chi$ Errors&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># Grab the dynamic range of both mean errors</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vars_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vars_df_log</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vars_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vars_df_log</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1">#Plot variances for vanilla IRASA</span>
<span class="n">cax_var</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">vars_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f_s$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Plot variances for vanilla IRASA</span>
<span class="n">cax_var2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">vars_df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f_s$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_var2</span><span class="p">)</span>

<span class="c1"># Set tick marks and tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FS_RANGE</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FS_RANGE</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FS_RANGE</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_7_0.png" src="../_images/EricIRASANotes_7_0.png" />
<img alt="../_images/EricIRASANotes_7_1.png" src="../_images/EricIRASANotes_7_1.png" />
</div>
</div>
<p>As expected, both versions of IRASA give good estimates <span class="math notranslate nohighlight">\(\chi\)</span>. It is interesting to see that the average error decreases in absolute value once the sampling rate is greater than or equal to 250Hz for vanilla IRASA, whereas the log spaced IRASA seems to have a better performance when the sampling rate is 150Hz. Otherwise, the two are almost identical.</p>
</div>
<div class="section" id="aperiodic-1-sinusoid">
<h2>Aperiodic + 1 Sinusoid<a class="headerlink" href="#aperiodic-1-sinusoid" title="Permalink to this headline">¶</a></h2>
<p>Next, we see how the two versions of IRASA perform when we add one sinusoid to the aperiodic component. Instead of looking at the error as a function of <span class="math notranslate nohighlight">\(\chi\)</span> and <span class="math notranslate nohighlight">\(f_s\)</span>, we will now look at it as a function of <span class="math notranslate nohighlight">\(\chi\)</span> and the frequency of the oscillation. As before, we look at the average error and the variance of the error across multiple trials because of the randomness in generating the aperiodic component.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the dataframes</span>
<span class="n">parameter_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)))</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_grid</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_log</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Run the experiment</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chi</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">trial_idx</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)):</span>
    <span class="n">irasa_exp</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="p">[</span><span class="n">freq</span><span class="p">],</span> <span class="n">F_RANGE</span><span class="p">)</span>
    <span class="n">irasa_exp_logspace</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="p">[</span><span class="n">freq</span><span class="p">],</span> <span class="n">F_RANGE</span><span class="p">,</span> <span class="n">log_space_irasa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">loc_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trial_idx</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">irasa_exp</span> <span class="o">-</span> <span class="n">chi</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">irasa_exp_logspace</span> <span class="o">-</span> <span class="n">chi</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>213.32 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a dataframe of average errors and keep track of the variances as well</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;chi_err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="c1"># Get rid of the top level of column label to make pivoting easier</span>
<span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="c1"># Finally, flatten the index</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>

<span class="n">mean_var_df_log</span> <span class="o">=</span> <span class="n">df_log</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;chi_err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="n">mean_var_df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>

<span class="c1"># Pivot to get a matrix of mean errors and variances</span>
<span class="n">mean_errs_df</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vars_df</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">mean_errs_df_log</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vars_df_log</span> <span class="o">=</span> <span class="n">mean_var_df_log</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">])[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1">##################################</span>
<span class="c1">#   </span>
<span class="c1">#  Vanilla IRASA Heat Maps</span>
<span class="c1">#</span>
<span class="c1">##################################</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Mean of $\chi$ Errors&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Grab the dynamic range of both mean errors</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mean_errs_df_log</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">mean_errs_df_log</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Plot mean errors for both IRASAs</span>
<span class="n">cax_mean</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plot mean errors for vanilla IRASA</span>
<span class="n">cax_mean2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_errs_df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_mean2</span><span class="p">)</span>

<span class="c1"># Set tick marks and tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FREQS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)]);</span>

<span class="c1">##################################</span>
<span class="c1">#   </span>
<span class="c1">#  Log spaced IRASA Heat Maps</span>
<span class="c1">#</span>
<span class="c1">##################################</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Variance of $\chi$ Errors&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># Grab the dynamic range of both mean errors</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vars_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vars_df_log</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vars_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vars_df_log</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1">#Plot variances for vanilla IRASA</span>
<span class="n">cax_var</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">vars_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Plot variances for vanilla IRASA</span>
<span class="n">cax_var2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">vars_df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_var2</span><span class="p">)</span>

<span class="c1"># Set tick marks and tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FREQS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_12_0.png" src="../_images/EricIRASANotes_12_0.png" />
<img alt="../_images/EricIRASANotes_12_1.png" src="../_images/EricIRASANotes_12_1.png" />
</div>
</div>
<p>Once again, these results are totally unsurprising. IRASA was built to succeed in the setting where there are only very few oscillations.</p>
</div>
<div class="section" id="aperiodic-4-well-spaced-sinusoids-not-sure-about-this-experiment-anymore">
<h2>Aperiodic + 4 Well-Spaced Sinusoids (Not sure about this experiment anymore)<a class="headerlink" href="#aperiodic-4-well-spaced-sinusoids-not-sure-about-this-experiment-anymore" title="Permalink to this headline">¶</a></h2>
<p>IRASA does well with more than one simple oscillatory component provided the frequencies of the sinusoids are sufficiently far apart.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the dataframes</span>
<span class="n">parameter_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)))</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameter_grid</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_log</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">),</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">index</span><span class="o">=</span><span class="n">FREQS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">CHIS</span><span class="p">)</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">),</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">index</span><span class="o">=</span><span class="n">FREQS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">CHIS</span><span class="p">)</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chi</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">trial_idx</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)):</span>
    <span class="c1"># Here, take 4 equispaced frequencies in log space between freq and the maximum frequency in F_RANGE.</span>
    <span class="n">sine_freqs</span> <span class="o">=</span> <span class="n">log_space_freqs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">F_RANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># Estimate chi</span>
    <span class="n">irasa_exp</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">sine_freqs</span><span class="p">,</span> <span class="n">F_RANGE</span><span class="p">)</span>
    <span class="n">irasa_exp_logspace</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">sine_freqs</span><span class="p">,</span> <span class="n">F_RANGE</span><span class="p">,</span> <span class="n">log_space_irasa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">freq</span><span class="p">][</span><span class="n">chi</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi</span> <span class="o">-</span> <span class="n">irasa_exp</span><span class="p">)</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">freq</span><span class="p">][</span><span class="n">chi</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi</span> <span class="o">-</span> <span class="n">irasa_exp_logspace</span><span class="p">)</span>
    
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">/=</span> <span class="n">NUM_TRIALS</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>483.50 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matrix plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">))],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FREQS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">))])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Absolute Error in Estimating $\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fa802d5efd0&gt;
</pre></div>
</div>
<img alt="../_images/EricIRASANotes_17_1.png" src="../_images/EricIRASANotes_17_1.png" />
</div>
</div>
</div>
<div class="section" id="aperiodic-cluster-of-sinusoids-seems-redundant-with-central-frequency">
<h2>Aperiodic + Cluster of Sinusoids (seems redundant with central frequency)<a class="headerlink" href="#aperiodic-cluster-of-sinusoids-seems-redundant-with-central-frequency" title="Permalink to this headline">¶</a></h2>
<p>However, IRASA does have difficulties when there are multiple sinusoids whose frequencies are close to one another. Below, we superimpose an aperiodic component with a sum of sinusoids whose frequencies span a length of 0.5 in logarithmic spacing of frequencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">),</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">index</span><span class="o">=</span><span class="n">FREQS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">CHIS</span><span class="p">)</span>
<span class="n">df_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">),</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">index</span><span class="o">=</span><span class="n">FREQS</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">CHIS</span><span class="p">)</span>
<span class="n">bw</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chi</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">trial_idx</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)):</span>
    <span class="c1"># Sum sinusoids of frequencies whose bandwidth is bw in log space of frequencies.</span>
    <span class="n">f_end</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">bw</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>
    <span class="n">sine_freqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">f_end</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">N_SECONDS</span><span class="p">)]</span>
    <span class="n">irasa_exp</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">sine_freqs</span><span class="p">,</span> <span class="n">F_RANGE</span><span class="p">)</span>
    <span class="n">irasa_exp_logspace</span> <span class="o">=</span> <span class="n">multiple_sines_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">sine_freqs</span><span class="p">,</span> <span class="n">F_RANGE</span><span class="p">,</span> <span class="n">log_space_irasa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">freq</span><span class="p">][</span><span class="n">chi</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi</span> <span class="o">-</span> <span class="n">irasa_exp</span><span class="p">)</span>
    <span class="n">df_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">freq</span><span class="p">][</span><span class="n">chi</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi</span> <span class="o">-</span> <span class="n">irasa_exp_logspace</span><span class="p">)</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">/=</span> <span class="n">NUM_TRIALS</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1205.41 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matrix plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df_log</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">))],</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FREQS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FREQS</span><span class="p">))])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Absolute Error in Estimating $\chi$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Vanilla IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Spaced IRASA&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fbee115dc10&gt;
</pre></div>
</div>
<img alt="../_images/EricIRASANotes_20_1.png" src="../_images/EricIRASANotes_20_1.png" />
</div>
</div>
</div>
<div class="section" id="aperiodic-with-central-frequency">
<h2>Aperiodic with Central Frequency<a class="headerlink" href="#aperiodic-with-central-frequency" title="Permalink to this headline">¶</a></h2>
<p>Now we’ll test how IRASA performs on signals with an oscillatory and aperiodic component as in the context of FOOOF where there is a central frequency with a pre-defined bandwidth and relative height above the aperiodic component. Here, we’ll look at the error as a function of <span class="math notranslate nohighlight">\(\chi\)</span>, the central_frequency, the bandwidth, and the relative height. This experiment takes a very long time to run because there are so many parameters to run experiments over. To look at the results of one instance of this experiment, you can run the cell that loads the dataframe from a csv file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set constants for this particular experiment</span>
<span class="n">HEIGHTS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1">## in 10**Hz </span>
<span class="n">BANDWIDTHS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">## in Hz</span>
<span class="n">parameter_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">CHIS</span><span class="p">,</span> <span class="n">FREQS</span><span class="p">,</span> <span class="n">HEIGHTS</span><span class="p">,</span> <span class="n">BANDWIDTHS</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">)))</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">NUM_TRIALS</span><span class="o">*</span><span class="n">HEIGHTS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">BANDWIDTHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;rel_height&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;chi_err&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="k">def</span> <span class="nf">_proxy</span><span class="p">(</span><span class="n">parameter_grid</span><span class="p">,</span> <span class="n">n_seconds</span><span class="o">=</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">FS</span><span class="p">,</span> <span class="n">f_range</span><span class="o">=</span><span class="n">F_RANGE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows easier mapping of grid params.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    In central_frequency_trial would return the same value when the first four params were the same,</span>
<span class="sd">    but only for the parallel_func, and not when running serially.</span>
<span class="sd">    i.e. array([[-0.,  1.,  0.,  1.,  0.],</span>
<span class="sd">                [-0.,  1.,  0.,  1.,  1.],</span>
<span class="sd">                [-0.,  1.,  0.,  1.,  2.]])</span>
<span class="sd">              </span>
<span class="sd">    I added a seed arg to central_frequency_trial so random signals could be simulated.</span>
<span class="sd">    Not sure why multiprocessing returns the same values without this, or how it sets</span>
<span class="sd">    random seeds, esp since it&#39;s not a prob when running serially.</span>
<span class="sd">    </span>
<span class="sd">    Anyways, the seed arg is a hack to ensure diff values during simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">central_frequency_trial</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">f_range</span><span class="p">,</span> <span class="o">*</span><span class="n">parameter_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                   <span class="n">seed</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span> <span class="o">+</span> <span class="n">parameter_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">parallel_func</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameter_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;Compute exponents in parallel.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_jobs : int, optional, default: -1</span>
<span class="sd">        Number of jobs to run in parallel </span>
<span class="sd">        (i.e number of cores of threads if cores are hyperthreaded)</span>
<span class="sd">        Defaults to maximum, in my case 12 jobs (6 hyperthreaded cores).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="k">if</span> <span class="n">n_jobs</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">n_jobs</span>
    
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        
        <span class="c1"># If you run out of memory, use imap instead of map.</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">_proxy</span><span class="p">,</span> <span class="n">n_seconds</span><span class="o">=</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">FS</span><span class="p">,</span> <span class="n">f_range</span><span class="o">=</span><span class="n">F_RANGE</span><span class="p">),</span>
                           <span class="n">parameter_grid</span><span class="p">)</span>
        <span class="n">fit_exps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Fitting Exponents&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">parameter_grid</span><span class="p">),</span> <span class="n">dynamic_ncols</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="n">fit_exps</span>

<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">fit_exps</span> <span class="o">=</span> <span class="n">parallel_func</span><span class="p">(</span><span class="n">parameter_grid</span><span class="o">=</span><span class="n">parameter_grid</span><span class="p">)</span>
<span class="k">for</span> <span class="n">irasa_exp</span><span class="p">,</span> <span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">ht</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fit_exps</span><span class="p">,</span> <span class="n">parameter_grid</span><span class="p">):</span>
    <span class="n">loc_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;central_freq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">central_freq</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rel_height&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ht</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bw</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trial</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">][</span><span class="s1">&#39;chi_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">irasa_exp</span><span class="o">-</span><span class="n">chi</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternatively, load the data from the csv file</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./full_central_freq_IRASA_experiment2.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a dataframe of average errors and keep track of the variances as well</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;rel_height&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;chi_err&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="c1"># Get rid of the top level of column label to make pivoting easier</span>
<span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">()</span>
<span class="c1"># Finally, flatten the index</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>

<span class="n">plot_chis</span> <span class="o">=</span> <span class="p">[</span><span class="n">CHIS</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">plot_heights</span> <span class="o">=</span> <span class="p">[</span><span class="n">HEIGHTS</span><span class="p">[</span><span class="mi">0</span><span class="p">],]</span>

<span class="k">for</span> <span class="n">chi</span> <span class="ow">in</span> <span class="n">plot_chis</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ht_idx</span><span class="p">,</span> <span class="n">ht</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_heights</span><span class="p">):</span>
        
        <span class="n">loc_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;rel_height&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ht</span><span class="p">)</span>
        
        <span class="c1"># Subselect only those rows for which the chi and the relative height are fixed.</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]]</span>

        <span class="c1"># Pivot to get a matrix of mean errors and variances</span>
        <span class="n">mean_errs_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">])[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vars_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;central_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;bandwidth&#39;</span><span class="p">])[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1">##################################</span>
        <span class="c1">#   </span>
        <span class="c1">#  Vanilla IRASA Heat Maps</span>
        <span class="c1">#</span>
        <span class="c1">##################################</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Error Statistics of $\chi$ Errors, $(\chi, h)$ = (</span><span class="si">{</span><span class="n">chi</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ht</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Grab the dynamic range of mean errors and variances</span>
        <span class="n">vmin_mean</span> <span class="o">=</span> <span class="n">mean_errs_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax_mean</span> <span class="o">=</span> <span class="n">mean_errs_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        
        <span class="n">vmin_var</span> <span class="o">=</span> <span class="n">vars_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax_var</span> <span class="o">=</span> <span class="n">vars_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># Plot mean errors</span>
        <span class="n">cax_mean</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_errs_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin_mean</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_mean</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Central Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Bandwidth&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Error&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_mean</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
        <span class="c1"># Plot variance of errors</span>
        <span class="n">cax_var</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">vars_df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin_var</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_var</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Central Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Bandwidth&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Variance of Error&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax_var</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Set tick marks and tick labels</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
                <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">FREQS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FREQS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)],</span>
                <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BANDWIDTHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
                <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="n">BANDWIDTHS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BANDWIDTHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_25_0.png" src="../_images/EricIRASANotes_25_0.png" />
</div>
</div>
</div>
<div class="section" id="closer-look-low-frequency-central-frequencies">
<h2>Closer Look: Low Frequency Central Frequencies<a class="headerlink" href="#closer-look-low-frequency-central-frequencies" title="Permalink to this headline">¶</a></h2>
<p>IRASA seems to perform worse at estimating the power law exponent when the relative height and bandwidth of the central frequency are large, especially so when the central frequency is a low frequency oscillation. The data suggest two conclusions:</p>
<ol class="simple">
<li><p>all else constant, the effect of <span class="math notranslate nohighlight">\(\chi\)</span> is minimal on the mean error and the variance of the error, and</p></li>
<li><p>for low frequency central frequencies, there is a negative bias in estimating <span class="math notranslate nohighlight">\(\chi\)</span>.</p></li>
</ol>
<p>The negative bias in estimating <span class="math notranslate nohighlight">\(\chi\)</span> is unsurprising, as we expect such a bump in  to artificially inflate the ceptstrum even after IRASA attempts to average it out. This inflated estimate of the power naturally affects the slope of the cepstrum by making it steeper. Indeed, we see this in various instances of such a signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
<span class="n">central_freq</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># In Hz</span>
<span class="n">bandwidth</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># In Hz</span>
<span class="n">rel_height</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># In 10**Hz</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time Series&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Empirical Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;IRASA Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">sig</span> <span class="o">=</span> <span class="n">sim_central_freq</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">rel_height</span><span class="p">)</span>
<span class="n">plot_time_series</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">compute_spectrum</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>
<span class="n">plot_power_spectra</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">FS</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">F_RANGE</span><span class="p">}</span>
<span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
<span class="n">fit_offset</span><span class="p">,</span> <span class="n">fit_chi</span> <span class="o">=</span> <span class="n">fit_irasa</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span><span class="n">psd_ap</span><span class="p">)</span>

<span class="n">true_psd</span> <span class="o">=</span> <span class="n">freqs_irasa</span><span class="o">**</span><span class="n">chi</span>
<span class="n">fit_psd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">fit_offset</span><span class="o">*</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">fit_chi</span> 
<span class="c1"># Normalize to match intercept with curve fitted irasa PSD</span>
<span class="n">true_psd</span> <span class="o">=</span> <span class="n">fit_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">true_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">true_psd</span>
<span class="n">plot_power_spectra</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="p">[</span><span class="n">psd_ap</span><span class="p">,</span> <span class="n">fit_psd</span><span class="p">,</span> <span class="n">true_psd</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IRASA AP PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;Fit PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;True PSD&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_27_0.png" src="../_images/EricIRASANotes_27_0.png" />
</div>
</div>
</div>
<div class="section" id="closer-look-high-frequency-central-frequency">
<h2>Closer Look: High Frequency Central Frequency<a class="headerlink" href="#closer-look-high-frequency-central-frequency" title="Permalink to this headline">¶</a></h2>
<p>In contrast to the low frequency setting, when the central frequency is a high frequency oscillation we expect this bump to artificially push the powers of the high frequency up, even after IRASA tries to average the central frequency out. Consequentially, this will lead to an estimated <span class="math notranslate nohighlight">\(\chi\)</span> which is smaller in absolute value than the true value. And indeed, this is the case for various instances of such a signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
<span class="n">central_freq</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># In Hz</span>
<span class="n">bandwidth</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># In Hz</span>
<span class="n">rel_height</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># In 10**Hz</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time Series&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Empirical Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;IRASA Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">sig</span> <span class="o">=</span> <span class="n">sim_central_freq</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">central_freq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">rel_height</span><span class="p">)</span>
<span class="n">plot_time_series</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">compute_spectrum</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>
<span class="n">plot_power_spectra</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">FS</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">F_RANGE</span><span class="p">}</span>
<span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
<span class="n">fit_offset</span><span class="p">,</span> <span class="n">fit_chi</span> <span class="o">=</span> <span class="n">fit_irasa</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span><span class="n">psd_ap</span><span class="p">)</span>

<span class="n">true_psd</span> <span class="o">=</span> <span class="n">freqs_irasa</span><span class="o">**</span><span class="n">chi</span>
<span class="n">fit_psd</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">fit_offset</span><span class="o">*</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">fit_chi</span> 
<span class="c1"># Normalize to match intercept with curve fitted irasa PSD</span>
<span class="n">true_psd</span> <span class="o">=</span> <span class="n">fit_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">true_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">true_psd</span>
<span class="n">plot_power_spectra</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="p">[</span><span class="n">psd_ap</span><span class="p">,</span> <span class="n">fit_psd</span><span class="p">,</span> <span class="n">true_psd</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IRASA AP PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;Fit PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;True PSD&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_29_0.png" src="../_images/EricIRASANotes_29_0.png" />
</div>
</div>
</div>
<div class="section" id="aperiodic-noise-with-knee">
<h2>Aperiodic Noise with Knee<a class="headerlink" href="#aperiodic-noise-with-knee" title="Permalink to this headline">¶</a></h2>
<p>Now let’s take a look at how IRASA behaves on aperiodic noise with no oscillations when the power spectrum follows a knee model. Here, we have three parameters to estimate: the knee, and the two power laws. In the below experiments, we look at estimating only the power law exponents. Further, we only look at those cases in which the exponent of the second half of the knee does not exceed 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set constants for this particular experiment</span>
<span class="c1"># Only choose pairs of chis for which the slope of the second half of the knee is steeper than the first.</span>
<span class="c1"># NOTE: The knee simulation uses the convention that chi&#39;s are **positive** whereas neurodsp uses negative chis.</span>
<span class="c1"># So use positive chi pairs here.</span>
<span class="n">CHI_PAIRS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span> <span class="k">for</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">-</span><span class="n">CHIS</span><span class="p">,</span> <span class="o">-</span><span class="n">CHIS</span><span class="p">)</span> <span class="k">if</span> <span class="n">chi1</span> <span class="o">+</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">KNEES</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">parameter_grid</span> <span class="o">=</span> <span class="p">[(</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">),</span> <span class="n">knee</span><span class="p">,</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">CHI_PAIRS</span><span class="p">,</span> <span class="n">KNEES</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TRIALS</span><span class="p">))]</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">CHI_PAIRS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">KNEES</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NUM_TRIALS</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span><span class="mi">7</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;chi1&quot;</span><span class="p">,</span> <span class="s2">&quot;chi2&quot;</span><span class="p">,</span> <span class="s2">&quot;knee&quot;</span><span class="p">,</span> <span class="s2">&quot;trial&quot;</span><span class="p">,</span> <span class="s2">&quot;err_chi1&quot;</span><span class="p">,</span> <span class="s2">&quot;err_chi2&quot;</span><span class="p">,</span> <span class="s2">&quot;err_knee&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;knee&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parameter_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span><span class="p">,</span> <span class="n">trial_idx</span> <span class="ow">in</span> <span class="n">parameter_grid</span><span class="p">:</span>
    <span class="n">fit_chi1</span><span class="p">,</span> <span class="n">fit_chi2</span><span class="p">,</span> <span class="n">fit_knee</span> <span class="o">=</span> <span class="n">knee_trial</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">f_range</span><span class="o">=</span><span class="n">F_RANGE</span><span class="p">,</span> <span class="n">chi1</span><span class="o">=</span><span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="o">=</span><span class="n">chi2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">knee</span><span class="p">)</span>
    <span class="n">loc_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;chi2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chi2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">knee</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trial_idx</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;err_chi1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_chi1</span> <span class="o">-</span> <span class="n">chi1</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;err_chi2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_chi2</span> <span class="o">-</span> <span class="n">chi2</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">loc_mask</span><span class="p">,</span> <span class="s1">&#39;err_knee&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_knee</span> <span class="o">-</span> <span class="n">knee</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3148.37 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataframe from file</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;full_knee_experiment.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="visualizing-the-errors">
<h3>Visualizing the Errors<a class="headerlink" href="#visualizing-the-errors" title="Permalink to this headline">¶</a></h3>
<p>As before, we’ll take a look at the mean error and the variance of the errors as heatmaps where we let <span class="math notranslate nohighlight">\(\chi_1\)</span>, <span class="math notranslate nohighlight">\(\chi_2\)</span> range over their possible values and for a fixed knee. If you would like to see more or less heat maps, you may modify the <code class="docutils literal notranslate"><span class="pre">plot_knees</span></code> variable below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_knees</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNEES</span><span class="p">[</span><span class="mi">5</span><span class="p">],]</span>

<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;knee&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;err_chi1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="s1">&#39;err_chi2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="s1">&#39;err_knee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_var_df</span><span class="o">.</span><span class="n">to_records</span><span class="p">())</span>
<span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;knee&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi1_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi1_std&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_std&#39;</span><span class="p">,</span> <span class="s1">&#39;err_knee_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;err_knee_std&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">knee</span> <span class="ow">in</span> <span class="n">plot_knees</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    
    <span class="c1"># Grab the dynamic range of the absolute errors so the heatmaps share a colorbar.</span>
    <span class="n">vmin_mean</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;err_chi1_mean&#39;</span><span class="p">,</span>  <span class="s1">&#39;err_chi2_mean&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">vmax_mean</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;err_chi1_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_mean&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    
    <span class="n">vmin_var</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;err_chi1_std&#39;</span><span class="p">,</span>  <span class="s1">&#39;err_chi2_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">vmax_var</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;err_chi1_std&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
        
        <span class="c1"># Grab only the ch1, chi2, and err_chi columns</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Average Error in Estimating $\chi_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="c1"># Plot err_chi1_mean heatmap</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi1_mean&#39;</span><span class="p">]]</span>
            <span class="c1"># Pivot chi1 column</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">chi_mat_errs</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">err_chi1_mean</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Average Error in Estimating $\chi_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_mean&#39;</span><span class="p">]]</span>
            <span class="c1"># Pivot chi1 column</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">chi_mat_errs</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">err_chi2_mean</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Variance of Error in Estimating $\chi_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi1_std&#39;</span><span class="p">]]</span>
            <span class="c1"># Pivot chi1 column</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">chi_mat_errs</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">err_chi1_std</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Variance of Error in Estimating $\chi_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mean_var_df</span><span class="p">[</span><span class="s1">&#39;knee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">knee</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">,</span> <span class="s1">&#39;err_chi2_std&#39;</span><span class="p">]]</span>
            <span class="c1"># Pivot chi1 column</span>
            <span class="n">chi_mat_errs</span> <span class="o">=</span> <span class="n">chi_mat_errs</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;chi1&#39;</span><span class="p">,</span> <span class="s1">&#39;chi2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">err_chi2_std</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Adjust the range for the colorbar based on whether you&#39;re plotting means or variances</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">chi_mat_errs</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin_mean</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_mean</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">chi_mat_errs</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin_var</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_var</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\chi_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
        
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)]</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">CHIS</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CHIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
                <span class="n">xticklabels</span><span class="o">=</span><span class="n">ticklabels</span><span class="p">,</span>
                <span class="n">yticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
                <span class="n">yticklabels</span><span class="o">=</span><span class="n">ticklabels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span> 
            <span class="c1"># Add color bar to last mean or variance plot</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Knee = </span><span class="si">{</span><span class="n">knee</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_36_0.png" src="../_images/EricIRASANotes_36_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="closer-look">
<h2>Closer Look<a class="headerlink" href="#closer-look" title="Permalink to this headline">¶</a></h2>
<p>It looks like IRASA performs the worst for estimating both <span class="math notranslate nohighlight">\(\chi_1\)</span> and <span class="math notranslate nohighlight">\(\chi_2\)</span> when the knee is zero. This isn’t surprising though, because without the knee the two power law exponents combine to form a simple power law. There are infinitely many choices of the two exponents in this case that would yield the same power spectrum.</p>
<p>Another trend thats apparent in the above heat maps is that IRASA seems to perform worse at estimating both exponents in the regime where (\chi_2) is near zero and (\chi_1) is near 3.</p>
<p>Let’s take a detailed look at one example and compare what the true PSD is to what IRASA estimates it to be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chi1</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">chi2</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">knee</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">create_times</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>

<span class="n">sig</span> <span class="o">=</span> <span class="n">sim_knee</span><span class="p">(</span><span class="n">N_SECONDS</span><span class="p">,</span> <span class="n">FS</span><span class="p">,</span> <span class="n">chi1</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">knee</span><span class="p">)</span>
<span class="n">plot_time_series</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
<span class="n">freqs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">compute_spectrum</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">FS</span><span class="p">)</span>

<span class="n">irasa_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fs&#39;</span> <span class="p">:</span> <span class="n">FS</span><span class="p">,</span> <span class="s1">&#39;f_range&#39;</span> <span class="p">:</span> <span class="n">F_RANGE</span><span class="p">}</span>
<span class="n">freqs_irasa</span><span class="p">,</span> <span class="n">psd_ap</span><span class="p">,</span> <span class="n">psd_pe</span> <span class="o">=</span> <span class="n">compute_irasa</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="o">**</span><span class="n">irasa_params</span><span class="p">)</span>
<span class="n">fit_offset</span><span class="p">,</span> <span class="n">fit_chi1</span><span class="p">,</span> <span class="n">fit_chi2</span><span class="p">,</span> <span class="n">fit_knee</span> <span class="o">=</span> <span class="n">fit_irasa_knee</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span><span class="n">psd_ap</span><span class="p">)</span>

<span class="n">true_psd</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">chi1</span><span class="o">*</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">chi2</span> <span class="o">+</span> <span class="n">knee</span><span class="p">))</span>
<span class="n">fit_psd</span> <span class="o">=</span> <span class="n">fit_offset</span><span class="o">/</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">fit_chi1</span> <span class="o">*</span> <span class="p">(</span><span class="n">freqs_irasa</span><span class="o">**</span><span class="n">fit_chi2</span> <span class="o">+</span> <span class="n">fit_knee</span><span class="p">))</span>
<span class="c1"># Normalize to match intercept with curve fitted irasa PSD</span>
<span class="n">true_psd</span> <span class="o">=</span> <span class="n">fit_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">true_psd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">true_psd</span>
<span class="n">plot_power_spectra</span><span class="p">(</span><span class="n">freqs_irasa</span><span class="p">,</span> <span class="p">[</span><span class="n">psd_ap</span><span class="p">,</span> <span class="n">fit_psd</span><span class="p">,</span> <span class="n">true_psd</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;IRASA AP PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;Fit PSD&quot;</span><span class="p">,</span> <span class="s2">&quot;True PSD&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/EricIRASANotes_38_0.png" src="../_images/EricIRASANotes_38_0.png" />
<img alt="../_images/EricIRASANotes_38_1.png" src="../_images/EricIRASANotes_38_1.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Thomas Donoghue<br/>
        
            &copy; Copyright 2021-.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>